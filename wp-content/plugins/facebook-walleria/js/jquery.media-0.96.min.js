//Copyright (c) 2007-2010 M. Alsup
//Dual licensed under the MIT and GPL licenses:
//http://www.opensource.org/licenses/mit-license.php
//http://www.gnu.org/licenses/gpl.html
(function(a){function k(c,d,e){var f=a(c);var g=a.fn.media.defaults.players[e];if(e=="iframe"){g=a("<iframe"+' width="'+d.width+'" height="'+d.height+'" >');g.attr("src",d.src);g.css("backgroundColor",g.bgColor)}else if(e=="img"){g=a("<img>");g.attr("src",d.src);d.width&&g.attr("width",d.width);d.height&&g.attr("height",d.height);g.css("backgroundColor",g.bgColor)}else if(b){var h=['<object width="'+d.width+'" height="'+d.height+'" '];for(var i in d.attrs)h.push(i+'="'+d.attrs[i]+'" ');for(var i in g.ieAttrs||{}){var j=g.ieAttrs[i];if(i=="codebase"&&window.location.protocol=="https:")j=j.replace("http","https");h.push(i+'="'+j+'" ')}h.push("></ob"+"ject"+">");var k=['<param name="'+(g.oUrl||"src")+'" value="'+d.src+'">'];for(var i in d.params)k.push('<param name="'+i+'" value="'+d.params[i]+'">');var g=document.createElement(h.join(""));for(var l=0;l<k.length;l++)g.appendChild(document.createElement(k[l]))}else if(d.standards){var h=['<object type="'+g.mimetype+'" width="'+d.width+'" height="'+d.height+'"'];if(d.src)h.push(' data="'+d.src+'" ');if(a.browser.msie){for(var i in g.ieAttrs||{}){var j=g.ieAttrs[i];if(i=="codebase"&&window.location.protocol=="https:")j=j.replace("http","https");h.push(i+'="'+j+'" ')}}h.push(">");h.push('<param name="'+(g.oUrl||"src")+'" value="'+d.src+'">');for(var i in d.params){if(i=="wmode"&&e!="flash")continue;h.push('<param name="'+i+'" value="'+d.params[i]+'">')}h.push("<div><p><strong>"+g.title+" Required</strong></p><p>"+g.title+' is required to view this media. <a href="'+g.pluginspage+'">Download Here</a>.</p></div>');h.push("</ob"+"ject"+">")}else{var h=['<embed width="'+d.width+'" height="'+d.height+'" style="display:block"'];if(d.src)h.push(' src="'+d.src+'" ');for(var i in d.attrs)h.push(i+'="'+d.attrs[i]+'" ');for(var i in g.eAttrs||{})h.push(i+'="'+g.eAttrs[i]+'" ');for(var i in d.params){if(i=="wmode"&&e!="flash")continue;h.push(i+'="'+d.params[i]+'" ')}h.push("></em"+"bed"+">")}var m=c.id?' id="'+c.id+'"':"";var n=d.cls?' class="'+d.cls+'"':"";var o=a("<div"+m+n+">");f.after(o).remove();b||e=="iframe"||e=="img"?o.append(g):o.html(h.join(""));if(d.caption)a("<div>").appendTo(o).html(d.caption);return o}function j(b,c){c=c||{};var d=a(b);var e=b.className||"";var f=a.metadata?d.metadata():a.meta?d.data():{};f=f||{};var g=f.width||parseInt((e.match(/\bw:(\d+)/)||[])[1]||0)||parseInt((e.match(/\bwidth:(\d+)/)||[])[1]||0);var h=f.height||parseInt((e.match(/\bh:(\d+)/)||[])[1]||0)||parseInt((e.match(/\bheight:(\d+)/)||[])[1]||0);if(g)f.width=g;if(h)f.height=h;if(e)f.cls=e;var i="data-";for(var j=0;j<b.attributes.length;j++){var k=b.attributes[j],l=a.trim(k.name);var m=l.indexOf(i);if(m===0){l=l.substring(i.length);f[l]=k.value}}var k=a.fn.media.defaults;var n=c;var o=f;var p={params:{bgColor:c.bgColor||a.fn.media.defaults.bgColor}};var q=a.extend({},k,n,o);a.each(["attrs","params","flashvars","silverlight"],function(b,c){q[c]=a.extend({},p[c]||{},k[c]||{},n[c]||{},o[c]||{})});if(typeof q.caption=="undefined")q.caption=d.text();q.src=q.src||d.attr("href")||d.attr("src")||"unknown";return q}function i(a){return"0123456789".indexOf(a)>-1}function h(a){return function(b,c){return k(b,c,a)}}function g(){var b="";for(var c in a.fn.media.defaults.players){if(b.length)b+=",";b+=a.fn.media.defaults.players[c].types}return new RegExp("\\.("+b.replace(/,/ig,"|")+")\\b")}function c(){var a=navigator.plugins;for(var b=0;b<a.length;b++){var c=a[b];if(c["filename"]=="np-mswmp.dll")return true}return false}var b=a.browser.msie&&a.browser.version<9;a.fn.media=function(b,c,d){if(b=="undo"){return this.each(function(){var b=a(this);var c=b.data("media.origHTML");if(c)b.replaceWith(c)})}return this.each(function(){if(typeof b=="function"){d=c;c=b;b={}}var e=j(this,b);if(typeof c=="function")c(this,e);var f=g();var h=f.exec(e.src.toLowerCase())||[""];e.type?h[0]=e.type:h.shift();for(var k=0;k<h.length;k++){fn=h[k].toLowerCase();if(i(fn[0]))fn="fn"+fn;if(!a.fn.media[fn])continue;var l=a.fn.media[fn+"_player"];if(!e.params)e.params={};if(l){var m=l.autoplayAttr=="autostart";e.params[l.autoplayAttr||"autoplay"]=m?e.autoplay?1:0:e.autoplay?true:false}var n=a.fn.media[fn](this,e);n.css("backgroundColor",e.bgColor).width(e.width);if(e.canUndo){var o=a("<div></div>").append(this);n.data("media.origHTML",o.html())}if(typeof d=="function")d(this,n[0],e,l.name);break}})};a.fn.media.mapFormat=function(b,c){if(!b||!c||!a.fn.media.defaults.players[c])return;b=b.toLowerCase();if(i(b[0]))b="fn"+b;a.fn.media[b]=a.fn.media[c];a.fn.media[b+"_player"]=a.fn.media.defaults.players[c]};a.fn.media.defaults={standards:true,canUndo:true,width:400,height:400,autoplay:0,bgColor:"#ffffff",params:{wmode:"transparent"},attrs:{},flvKeyName:"file",flashvars:{},flashVersion:"7",expressInstaller:null,flvPlayer:"mediaplayer.swf",mp3Player:"mediaplayer.swf",silverlight:{inplaceInstallPrompt:"true",isWindowless:"true",framerate:"24",version:"0.9",onError:null,onLoad:null,initParams:null,userContext:null}};a.fn.media.defaults.players={flash:{name:"flash",title:"Flash",types:"flv,mp3,swf",mimetype:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",ieAttrs:{classid:"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",type:"application/x-oleobject",codebase:"http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version="+a.fn.media.defaults.flashVersion}},quicktime:{name:"quicktime",title:"QuickTime",mimetype:"video/quicktime",pluginspage:"http://www.apple.com/quicktime/download/",types:"aif,aiff,aac,au,bmp,gsm,mov,mid,midi,mpg,mpeg,mp4,m4a,psd,qt,qtif,qif,qti,snd,tif,tiff,wav,3g2,3gp",ieAttrs:{classid:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",codebase:"http://www.apple.com/qtactivex/qtplugin.cab"}},realplayer:{name:"real",title:"RealPlayer",types:"ra,ram,rm,rpm,rv,smi,smil",mimetype:"audio/x-pn-realaudio-plugin",pluginspage:"http://www.real.com/player/",autoplayAttr:"autostart",ieAttrs:{classid:"clsid:CFCDAA03-8BE4-11cf-B84B-0020AFBBCCFA"}},winmedia:{name:"winmedia",title:"Windows Media",types:"asx,asf,avi,wma,wmv",mimetype:a.browser.mozilla&&c()?"application/x-ms-wmp":"application/x-mplayer2",pluginspage:"http://www.microsoft.com/Windows/MediaPlayer/",autoplayAttr:"autostart",oUrl:"url",ieAttrs:{classid:"clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6",type:"application/x-oleobject"}},img:{name:"img",title:"Image",types:"gif,png,jpg"},iframe:{name:"iframe",types:"html,pdf"},silverlight:{name:"silverlight",types:"xaml"}};var d=1;for(var e in a.fn.media.defaults.players){var f=a.fn.media.defaults.players[e].types;a.each(f.split(","),function(b,c){if(i(c[0]))c="fn"+c;a.fn.media[c]=a.fn.media[e]=h(e);a.fn.media[c+"_player"]=a.fn.media.defaults.players[e]})}a.fn.media.swf=function(b,c){if(!window.SWFObject&&!window.swfobject){if(c.flashvars){var e=[];for(var f in c.flashvars)e.push(f+"="+c.flashvars[f]);if(!c.params)c.params={};c.params.flashvars=e.join("&")}return k(b,c,"flash")}var g=b.id?' id="'+b.id+'"':"";var h=c.cls?' class="'+c.cls+'"':"";var i=a("<div"+g+h+">");if(window.swfobject){a(b).after(i).appendTo(i);if(!b.id)b.id="movie_player_"+d++;swfobject.embedSWF(c.src,b.id,c.width,c.height,c.flashVersion,c.expressInstaller,c.flashvars,c.params,c.attrs)}else{a(b).after(i).remove();var j=new SWFObject(c.src,"movie_player_"+d++,c.width,c.height,c.flashVersion,c.bgColor);if(c.expressInstaller)j.useExpressInstall(c.expressInstaller);for(var l in c.params)if(l!="bgColor")j.addParam(l,c.params[l]);for(var f in c.flashvars)j.addVariable(f,c.flashvars[f]);j.write(i[0])}if(c.caption)a("<div>").appendTo(i).html(c.caption);return i};a.fn.media.flv=a.fn.media.mp3=function(b,c){var d=c.src;var e=/\.mp3\b/i.test(d)?a.fn.media.defaults.mp3Player:a.fn.media.defaults.flvPlayer;var f=c.flvKeyName;d=encodeURIComponent(d);c.src=e;c.src=c.src+"?"+f+"="+d;var g={};g[f]=d;c.flashvars=a.extend({},g,c.flashvars);return a.fn.media.swf(b,c)};a.fn.media.xaml=function(b,c){if(!window.Sys||!window.Sys.Silverlight){if(a.fn.media.xaml.warning)return;a.fn.media.xaml.warning=1;alert("You must include the Silverlight.js script.");return}var e={width:c.width,height:c.height,background:c.bgColor,inplaceInstallPrompt:c.silverlight.inplaceInstallPrompt,isWindowless:c.silverlight.isWindowless,framerate:c.silverlight.framerate,version:c.silverlight.version};var f={onError:c.silverlight.onError,onLoad:c.silverlight.onLoad};var g=b.id?' id="'+b.id+'"':"";var h=c.id||"AG"+d++;var i=c.cls?' class="'+c.cls+'"':"";var j=a("<div"+g+i+">");a(b).after(j).remove();Sys.Silverlight.createObjectEx({source:c.src,initParams:c.silverlight.initParams,userContext:c.silverlight.userContext,id:h,parentElement:j[0],properties:e,events:f});if(c.caption)a("<div>").appendTo(j).html(c.caption);return j};})(jQuery)
